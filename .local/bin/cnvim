#!/bin/bash

# Initialize FILE_PATH to 'main.cpp'
FILE_PATH=''
U_FLAG=false

# Parse command line options
while getopts ":u" opt; do
	case $opt in
		u)
			U_FLAG=true
			;;
		\?)
			echo "Invalid option: -$OPTARG" >&2
			exit 1
			;;
	esac
done

# Get positional argument (if any)
shift $((OPTIND -1))
if [ $# -eq 1 ]; then
	FILE_PATH=$1
fi

if [ "$U_FLAG" = true ] ;
then
	TEMPLATE="${HOME}/.config/nvim/templates/cpp_bits_additional_defines.cpp"
	LINE=20
else
	TEMPLATE="${HOME}/.config/nvim/templates/cpp_bits.cpp"
	LINE=10
fi

# Ask user for the filename
if [ "$FILE_PATH" == '' ] ;
then
	echo -n "Enter fhe filename: " && read FILE_PATH
fi

if [ "$FILE_PATH" == '' ] ;
then
	FILE_PATH="main"
fi

# Print variables for testing
# echo "U_FLAG=$U_FLAG"
# echo "FILE_PATH=$FILE_PATH"
# echo "TEMPLATE=$TEMPLATE"

cp "$TEMPLATE" "${FILE_PATH}.cpp"
nvim -c 'startinsert' +"$LINE" "${FILE_PATH}.cpp"
